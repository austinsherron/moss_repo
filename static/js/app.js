
////////////////////////////////////////////////////////////////////////////////
// App Declaration /////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


var app = angular.module('app', []);


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Controllers /////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


app.controller('getData', function($scope, $http) {

	/**
	 * Function to fetch filtered results data.
	 * @params {object} filters - Object that contains filter names and values.
	 */ 
	$scope.filter = function(filters) {
		$http.get("src/api.php?filters=" + JSON.stringify(filters)).then(function(response) {
			$scope.results = response.data;

		}, function(failure) {
			console.log(failure);
		});
	};


	/**
	 * Function that initializes app by fecthing results, course, and quarter data.
	 */
	$scope.reset = function() {
		$scope.filters = {};

		$http.get("src/api.php").then(function(response) {
			$scope.results = response.data.results;
			$scope.courses = response.data.courses;
			$scope.quarters = response.data.quarters;

		}, function(failure) {
			console.log(failure);
		});
	};


	/**
	 * Function that deletes one results record.
	 * @params {object} to_delete - Object that contains info used for selecting
     * record to delete.
	 */
	$scope.delete = function(to_delete) {
		$http.get("src/api.php?delete=" + JSON.stringify(to_delete)).then(function(response) {
			$scope.reset();
		}, function(failure) {
			console.log(failure);
		});
	};


	// init app
	$scope.reset();
});


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Filters /////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


app.filter('capitalize', function() {
    return function(input) {
      return (!!input) ? input.charAt(0).toUpperCase() + input.substr(1).toLowerCase() : '';
    }
});


app.filter('date', function() {
	return function(input) {
		return new Date();
	}
});


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Helpers /////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


/*
 * Function that returns the lenght of an object.
 * @params {object} obj - Object whose length is to be found.
 * @returns {int} - Length of obj.
 */
Object.size = function(obj) {
	var size = 0;
	
	for (var key in obj)
	{
		if (obj.hasOwnProperty(key))
			++size;
	}

	return size;
};


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
